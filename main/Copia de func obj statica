package main;

public class SensorsProblemObjectiveFunction{
	private static SquareGridProblemData conf;
	

	public double fitnessMaximizeRange(Individual transmissorsPopulationStatus, Location transmissorsPositions[], SquareGridProblemData conf, float alfa) {
		SensorsProblemObjectiveFunction.conf = conf;
		int coverageGrid[][] = initializeGrid();
		int usedTransmissors = 0;
		int availableTransmissorsNumber = transmissorsPopulationStatus.getAllele().length; //transmisores disponibles para ser usados
		
		for(int t=0; t<availableTransmissorsNumber; t++) { //t = transmissor
			int[] transmissorStatusAllele = transmissorsPopulationStatus.getAllele(); //describe el estado de los transmisores //apagados, desactivados
			if(transmissorStatusAllele[t]==1) {
				Location transmissorLocation = transmissorsPositions[t];
				CoverageLimits limits = new CoverageLimits(transmissorLocation, conf);
				for(int i=limits.getLimInfX(); i<limits.getLimSupX(); i++){
					for(int j=limits.getLimInfY(); j<limits.getLimSupY(); j++) {
						coverageGrid[i][j] = 1; //aca podria meter un contador para medir la interferencia
					}
				}
				usedTransmissors++;
			}	
		}
		return getFitness(coverageGrid, usedTransmissors, alfa);
	}
	
	private static int[][] initializeGrid(){
		int grid[][] = new int[conf.getGridSizeX()][conf.getGridSizeY()];
		for(int i=0; i<conf.getGridSizeX(); i++) {
			for(int j=0; j<conf.getGridSizeY(); j++) {
				grid[i][j] = 0;
			}
		}
		return grid;
	}
	
	private static double getFitness(int coverageGrid[][], int usedTransmissors, float alfa) {
		float coverRange = (100*getCoveredPoints(coverageGrid)) /conf.getGridSize();
		return Math.pow(coverRange, alfa) / usedTransmissors;
	}
	
	private static int getCoveredPoints(int coverageGrid[][]) {
		int coveredPoints = 0;
		for(int i=0; i<conf.getGridSizeX(); i++) {
			for(int j=0; j<conf.getGridSizeY(); j++) {
				coveredPoints += coverageGrid[i][j];
			}
		}
		return coveredPoints;
	}
	
	public class CoverageLimits {
		private int limInfX;
		private int limSupX;
		private int limInfY;
		private int limSupY;
		
		public CoverageLimits(Location transmissorLocation, SquareGridProblemData conf) {
			limInfX = Math.max( transmissorLocation.getPosX()-conf.getTransmissorRangeRatio(), 0);
			limSupX = Math.min( transmissorLocation.getPosX()+conf.getTransmissorRangeRatio(), conf.getGridSizeX() );
			limInfY = Math.max( transmissorLocation.getPosY()-conf.getTransmissorRangeRatio(), 0);
			limSupY = Math.min( transmissorLocation.getPosY()+conf.getTransmissorRangeRatio(), conf.getGridSizeY() );
		}

		public int getLimInfX() {
			return limInfX;
		}

		public int getLimSupX() {
			return limSupX;
		}

		public int getLimInfY() {
			return limInfY;
		}

		public int getLimSupY() {
			return limSupY;
		}
	}
}
